# What is this repository for?
This repository has code to both decode a .bin file (in the CAEN format) as well as read out data from a .root tree created by the decoder script. Additionally, you can also convert TTrees created by the main.C file in GramsAnalysis/file_convert into my format that prioritizes grouping data by events.

# How do you read the .bin file?
Use the tree_write.py script to do this. The data structure of the .bin files generated by CAEN for the "One file per board" option + header is as follows:
1. The first 4-bytes form the event number as an unsigned int.
2. The next 8-bytes form the timestamp as an unsigned int. I use unsigned long long to read it out with struct.
3. The next 4-bytes form the number of samples as an unsigned int.
4. The next 8-bytes form the sampling period as an unsigned int. I also used unsigned long long with this one.
5. The next 4-bytes form the number of active channels as a signed int.
6. The first 2-bytes form the specific channel number as a short int.
7. The waveform data follows. Each waveform sample is 4-byte float value. There are (number of samples * 4) bytes of data in total.

This pattern repeats until the end of the file.

# How is this data stored in the ROOT Tree?
The ROOT TTree has 7 branches and they are as follows:
1. event_num (event_num/I)
2. timestamp (timestamp/l)
3. num_of_samples (num_of_samples/I)
4. resolution (resolution/I)
5. num_of_channels (num_of_channels/I)
6. active_channels (active_channels\[channels]/I)
7. waveform_data (waveform_data\[channels*num_of_samples]/F)

The waveform_data branch is a flattened array with the following format (say we have 100 events and 36 channels as an example)
`[Event0ch0, Event0ch1, ..., Event0ch35, Event1ch0, Event1ch1, ..., Event100ch34, Event100ch35]`

# How do you read data out of the ROOT Tree?
There are 2 ways! You can either read the data out yourself or use an object of the Event class (as specified in Event_class.py).
## Doing it yourself
If you want to read the ROOT Tree yourself, please feel free to do so! If you'd like a quick example, look at tree_read_one_event.py. 
## Using the Event class
The Event class has different methods for loading in basic header information, creating a dictionary with the channels linked to their respective waveform data, etc. This will be documented further in the future.

# Can you convert large amounts of data from the GramsAnalysis/file_convert/main.C format to yours?
Not yet. This would require TChain functionality which has not been added yet. Stay tuned.
